<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Skywell Test World Tracking Letsee</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
	<script src="https://unpkg.com/three@0.123.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.123.0/examples/js/loaders/GLTFLoader.js"></script>
	<script src="https://developer.letsee.io/api/webar?key=171a5e81605e4ab029c0e52919634998c80ff7998a61c05c8244cfdbd50d578c"></script>	
</head>
<body>
<script>
	let scene;
    let camera;
    let renderer;
    let ambientLight;
    let directionalLight;
	let box;
    let mesh;
    let animations;
    let mixer;
    let entity;
    let clock = new THREE.Clock();
    let loader = new THREE.GLTFLoader();

    letsee.ready(() => {
        letsee.start();
        // Activate THREE.js library
        letsee.addTHREE(THREE).then(obj => {
            create3DWorld(obj);
        });
    });
    letsee.init({trackerType: 'image'});

    const onProgress = (xhr) => {
        if (xhr.lengthComputable) {
            const percentComplete = xhr.loaded / xhr.total * 100;
            console.warn(Math.round(percentComplete) + '%');
        }
    };

    const onError = (e) => {
        console.error(e);
    };
	
	const loadModel = (path) => {
        return new Promise((resolve) => {
            loader.load(path, function (gltf) {

                mesh = gltf.scene;
                animations = gltf.animations;

                //mesh.position.z = 30;
		mesh.rotation.x = 90;
                mesh.scale.setScalar(0.2);

                // Play model's animation
                if (animations.length) {
                    mixer = new THREE.AnimationMixer(mesh);
                    let action = mixer.clipAction(animations[0]);
                    action.play();
                } else console.warn(`Model does not have animation`);

                resolve(mesh);

            }, onProgress, onError);
        });
    }

    const create3DWorld = (obj) => {
        renderer = obj.renderer;
        scene = obj.scene;

        ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
        ambientLight.position.set(0, 0, 0);
        scene.add(ambientLight);

        directionalLight = new THREE.DirectionalLight(0xffffff);
        directionalLight.position.set(0, -95, 120);
        scene.add(directionalLight);
		
		// geometry
		var geometry = new THREE.BoxGeometry( 2, 2, 2 );
    
		// material
		var material1 = new THREE.MeshPhongMaterial( {
        color: 'gray'
		} );
    
		// mesh
		mesh = new THREE.Mesh( geometry, material1 );
		mesh.position.set( 0 , 0, -4 );
	    camera = letsee.threeRenderer().getDeviceCamera();
		camera.add( mesh );
		// camera = letsee.threeRenderer().getDeviceCamera();
		
		// Render all
        const animate = async function() {
            requestAnimationFrame(animate);
			renderer.render(scene, camera);		
            await letsee.threeRenderer().update();              
        };
        animate();
		
    }

</script>
</body>
</html>
